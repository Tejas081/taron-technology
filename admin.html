<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Taron Admin Dashboard</title>
<style>
body { background:#0d0d0d; color:white; font-family:Arial; padding:40px; }
h1 { text-align:center; margin-bottom:30px; }
.login-box { text-align:center; margin-top:100px; }
input { padding:10px; margin:10px; }
button { padding:10px 20px; cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #333; padding:10px; }
th { background:#1a1a1a; }
.delete-btn { background:red; color:white; border:none; padding:5px 10px; }
.export-btn { margin-bottom:15px; }
</style>
</head>
<body>

<div id="loginSection" class="login-box">
<h2>Admin Login</h2>
<input type="password" id="password" placeholder="Enter Admin Password">
<button onclick="login()">Login</button>
<p id="loginError" style="color:red;"></p>
</div>

<div id="dashboard" style="display:none;">
<h1>TARON ENQUIRY DASHBOARD</h1>
<button class="export-btn" onclick="exportCSV()">Export CSV</button>
<table id="table">
<thead>
<tr>
<th>Name</th>
<th>Email</th>
<th>Message</th>
<th>Date</th>
<th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>

let adminPassword = "";

function login() {
  adminPassword = document.getElementById("password").value;
  loadData();
}

async function loadData() {
  try {
    const res = await fetch("/api/getEnquiries", {
      headers: { "Authorization": adminPassword }
    });

    if (!res.ok) {
      document.getElementById("loginError").innerText = "Invalid Password";
      return;
    }

    const data = await res.json();

    document.getElementById("loginSection").style.display = "none";
    document.getElementById("dashboard").style.display = "block";

    const tbody = document.querySelector("#table tbody");
    tbody.innerHTML = "";

    data.forEach(item => {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.email}</td>
        <td>${item.message}</td>
        <td>${new Date(item.createdAt).toLocaleString()}</td>
        <td><button class="delete-btn" onclick="deleteItem('${item._id}')">Delete</button></td>
      `;

      tbody.appendChild(row);
    });

  } catch (error) {
    alert("Error loading data");
  }
}

async function deleteItem(id) {
  await fetch("/api/deleteEnquiry", {
    method: "DELETE",
    headers: {
      "Content-Type": "application/json",
      "Authorization": adminPassword
    },
    body: JSON.stringify({ id })
  });

  loadData();
}

function exportCSV() {
  const rows = Array.from(document.querySelectorAll("table tr"));
  const csv = rows.map(row =>
    Array.from(row.children).map(cell => `"${cell.innerText}"`).join(",")
  ).join("\n");

  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "taron-enquiries.csv";
  a.click();
}

</script>

</body>
</html>
